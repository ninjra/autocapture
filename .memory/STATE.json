{
  "banned_patterns": [
    "BEGIN PRIVATE KEY",
    "BEGIN RSA PRIVATE KEY",
    "AKIA[0-9A-Z]{16}",
    "ASIA[0-9A-Z]{16}",
    "ghp_[A-Za-z0-9]{36,}",
    "sk-[A-Za-z0-9-]{10,}",
    "eyJ[A-Za-z0-9_-]+\\\\.[A-Za-z0-9_-]+\\\\.[A-Za-z0-9_-]+",
    "(?i)password\\\\s*[:=]\\\\s*\\\\S+",
    "(?i)token\\\\s*[:=]\\\\s*\\\\S+",
    "(?i)secret\\\\s*[:=]\\\\s*\\\\S+",
    "[A-Za-z0-9+/]{80,}={0,2}"
  ],
  "decisions": [
    {
      "id": "ADR-0001",
      "title": "Adopt event-sourced repo memory"
    }
  ],
  "keys": {
    "citations.evidence-payload": {
      "source": "agent",
      "ts": "2026-01-16T14:25:00Z",
      "type": "fix",
      "value": "Answer JSON/TRON now includes evidence payload with event_id + timestamps; time-only queries return a cited timeline.",
      "why": "Guarantee citability and time-series behavior."
    },
    "docker.pinned-images": {
      "source": "agent",
      "ts": "2026-01-16T14:25:00Z",
      "type": "fix",
      "value": "Pinned core docker images (qdrant/postgres) and added qdrant healthcheck; docs aligned with pinned tags.",
      "why": "Reduce drift and improve service readiness checks."
    },
    "doctor.doctor-port-permission-skip": {
      "source": "agent",
      "ts": "2026-01-16T21:53:02Z",
      "type": "fix",
      "value": "Doctor port probes now skip on PermissionError; logging falls back to console-only if log dir cannot be created (non-Windows defaults use XDG_STATE_HOME).",
      "why": "Allow doctor/release gate to run in restricted environments without crashing."
    },
    "doctor.windows-appdata-fallback": {
      "source": "agent",
      "ts": "2026-01-16T14:25:00Z",
      "type": "fix",
      "value": "Resolved Windows LOCALAPPDATA fallback via ordered env/known-folder lookup; doctor path failures now report missing envs and override hints.",
      "why": "Prevent Git Bash/MSYS /home fallback and improve doctor actionability."
    },
    "enrichment.sql-artifacts-parse": {
      "source": "agent",
      "ts": "2026-01-17T04:35:35Z",
      "type": "fix",
      "value": "SQL artifact extraction now detects code blocks/keywords correctly and uses default sqlglot dialect to emit statements, tables, and parse errors.",
      "why": "Ensure deterministic SQL/code artifacts from VLM text."
    },
    "environment.target-machine": {
      "source": "user",
      "ts": "2026-01-15T05:03:00Z",
      "type": "fact",
      "value": "Windows 11 host with WSL2 backend and RTX 4090; single-monitor 7680x2160 capture.",
      "why": "Optimize defaults for the target machine."
    },
    "format.tron-support": {
      "source": "agent",
      "ts": "2026-01-16T12:49:28Z",
      "type": "fact",
      "value": "TRON encode/decode available for context packs and structured answers; output.format/context_pack_format control JSON vs TRON.",
      "why": "Reduce token overhead for structured payloads."
    },
    "global.local-first-default": {
      "source": "user",
      "ts": "2026-01-15T05:00:00Z",
      "type": "constraint",
      "value": "Default to local-only providers; cloud use requires explicit opt-in per stage.",
      "why": "Privacy-first, offline-friendly operation."
    },
    "global.patch-only": {
      "source": "user",
      "ts": "2026-01-15T05:01:00Z",
      "type": "constraint",
      "value": "Edits are patch/append-only; do not replace files unless new.",
      "why": "Keep changes reviewable and stable."
    },
    "memory.event-sourced-ledger": {
      "source": "user",
      "ts": "2026-01-15T05:05:00Z",
      "type": "decision",
      "value": {
        "status": "accepted",
        "title": "Adopt event-sourced repo memory"
      },
      "why": "Persist high-signal decisions across runs."
    },
    "repo.hygiene-guard": {
      "source": "agent",
      "ts": "2026-01-16T14:25:00Z",
      "type": "fix",
      "value": "Removed tracked obj/bin/node artifacts and added repo_hygiene_check guard in release gate and CI workflow.",
      "why": "Keep repo clean and prevent IDE/build artifacts from re-entering."
    },
    "research.scout-cli": {
      "source": "agent",
      "ts": "2026-01-16T12:49:28Z",
      "type": "fact",
      "value": "Research scout CLI writes ranked model/paper report, caches results, and appends docs/research/scout_log.md.",
      "why": "Surface new models/papers without auto-merge."
    },
    "research.scout-gha-scheduler": {
      "source": "agent",
      "ts": "2026-01-16T14:25:00Z",
      "type": "fact",
      "value": "Scheduled research scout workflow writes docs/research report and opens PRs only when diff threshold is exceeded.",
      "why": "Automate scouting without noisy updates."
    },
    "retention.legacy-roi-prune": {
      "source": "agent",
      "ts": "2026-01-17T04:35:35Z",
      "type": "fix",
      "value": "Retention now treats legacy image_path values outside media/screen as ROI for roi_days pruning and clears matching event paths while preserving full-screen captures.",
      "why": "Keep backward-compatible cleanup after fullscreen primary capture change."
    },
    "routing.stage-llm-router": {
      "source": "agent",
      "ts": "2026-01-16T12:49:28Z",
      "type": "fact",
      "value": "StageRouter selects LLMs per stage (query_refine, draft_generate, final_answer, tool_transform) with per-stage cloud opt-in.",
      "why": "Enforce local-first defaults with explicit cloud overrides."
    },
    "security.no-secrets-or-pii": {
      "source": "user",
      "ts": "2026-01-15T05:02:00Z",
      "type": "constraint",
      "value": "Never store secrets, tokens, PII, or medical data in repo memory/logs.",
      "why": "Security and privacy policy."
    },
    "stability.frozen-surfaces": {
      "source": "user",
      "ts": "2026-01-15T05:04:00Z",
      "type": "constraint",
      "value": "Unfreeze files in frozen_manifest.json before edits and refreeze after with reasons.",
      "why": "Protect stability surfaces from churn."
    },
    "threads.thread-events-flush-order": {
      "source": "agent",
      "ts": "2026-01-17T04:35:35Z",
      "type": "fix",
      "value": "ThreadStore flushes thread records before inserting thread_events to satisfy FK ordering; tests adjusted to flush before thread_events.",
      "why": "Prevent FK violations when creating new threads."
    },
    "tooling.release-gate-python": {
      "source": "agent",
      "ts": "2026-01-17T04:35:35Z",
      "type": "fix",
      "value": "Release gate now invokes memory_guard with sys.executable to avoid missing python shims in WSL/venv environments.",
      "why": "Keep release_gate portable across environments."
    },
    "vision.vlm-first-extraction": {
      "source": "agent",
      "ts": "2026-01-16T12:49:28Z",
      "type": "fact",
      "value": "VLM-first extraction with full-screen tiling; RapidOCR fallback; vision_extract tags + transcript stored in ocr_text.",
      "why": "Capture full-screen context with structured layout."
    }
  },
  "updated_at": "2026-01-17T04:35:35Z",
  "version": 1
}
