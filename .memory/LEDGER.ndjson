{"key":"local-first-default","scope":"global","source":"user","ts":"2026-01-15T05:00:00Z","type":"constraint","value":"Default to local-only providers; cloud use requires explicit opt-in per stage.","why":"Privacy-first, offline-friendly operation."}
{"key":"patch-only","scope":"global","source":"user","ts":"2026-01-15T05:01:00Z","type":"constraint","value":"Edits are patch/append-only; do not replace files unless new.","why":"Keep changes reviewable and stable."}
{"key":"no-secrets-or-pii","scope":"security","source":"user","ts":"2026-01-15T05:02:00Z","type":"constraint","value":"Never store secrets, tokens, PII, or medical data in repo memory/logs.","why":"Security and privacy policy."}
{"key":"target-machine","scope":"environment","source":"user","ts":"2026-01-15T05:03:00Z","type":"fact","value":"Windows 11 host with WSL2 backend and RTX 4090; single-monitor 7680x2160 capture.","why":"Optimize defaults for the target machine."}
{"key":"frozen-surfaces","scope":"stability","source":"user","ts":"2026-01-15T05:04:00Z","type":"constraint","value":"Unfreeze files in frozen_manifest.json before edits and refreeze after with reasons.","why":"Protect stability surfaces from churn."}
{"id":"ADR-0001","key":"event-sourced-ledger","scope":"memory","source":"user","ts":"2026-01-15T05:05:00Z","type":"decision","value":{"status":"accepted","title":"Adopt event-sourced repo memory"},"why":"Persist high-signal decisions across runs."}
{"key":"vlm-first-extraction","scope":"vision","source":"agent","ts":"2026-01-16T12:49:28Z","type":"fact","value":"VLM-first extraction with full-screen tiling; RapidOCR fallback; vision_extract tags + transcript stored in ocr_text.","why":"Capture full-screen context with structured layout."}
{"key":"stage-llm-router","scope":"routing","source":"agent","ts":"2026-01-16T12:49:28Z","type":"fact","value":"StageRouter selects LLMs per stage (query_refine, draft_generate, final_answer, tool_transform) with per-stage cloud opt-in.","why":"Enforce local-first defaults with explicit cloud overrides."}
{"key":"tron-support","scope":"format","source":"agent","ts":"2026-01-16T12:49:28Z","type":"fact","value":"TRON encode/decode available for context packs and structured answers; output.format/context_pack_format control JSON vs TRON.","why":"Reduce token overhead for structured payloads."}
{"key":"scout-cli","scope":"research","source":"agent","ts":"2026-01-16T12:49:28Z","type":"fact","value":"Research scout CLI writes ranked model/paper report, caches results, and appends docs/research/scout_log.md.","why":"Surface new models/papers without auto-merge."}
{"key":"scout-gha-scheduler","scope":"research","source":"agent","ts":"2026-01-16T12:49:28Z","type":"todo","value":"Optional scheduled GitHub Actions workflow to run research scout and open an issue/PR when changes exceed threshold.","why":"Automate scouting when CI is available."}
{"key":"windows-appdata-fallback","scope":"doctor","source":"agent","ts":"2026-01-16T14:25:00Z","type":"fix","value":"Resolved Windows LOCALAPPDATA fallback via ordered env/known-folder lookup; doctor path failures now report missing envs and override hints.","why":"Prevent Git Bash/MSYS /home fallback and improve doctor actionability."}
{"key":"hygiene-guard","scope":"repo","source":"agent","ts":"2026-01-16T14:25:00Z","type":"fix","value":"Removed tracked obj/bin/node artifacts and added repo_hygiene_check guard in release gate and CI workflow.","why":"Keep repo clean and prevent IDE/build artifacts from re-entering."}
{"key":"scout-gha-scheduler","scope":"research","source":"agent","supersedes":["research.scout-gha-scheduler"],"ts":"2026-01-16T14:25:00Z","type":"fact","value":"Scheduled research scout workflow writes docs/research report and opens PRs only when diff threshold is exceeded.","why":"Automate scouting without noisy updates."}
{"key":"evidence-payload","scope":"citations","source":"agent","ts":"2026-01-16T14:25:00Z","type":"fix","value":"Answer JSON/TRON now includes evidence payload with event_id + timestamps; time-only queries return a cited timeline.","why":"Guarantee citability and time-series behavior."}
{"key":"pinned-images","scope":"docker","source":"agent","ts":"2026-01-16T14:25:00Z","type":"fix","value":"Pinned core docker images (qdrant/postgres) and added qdrant healthcheck; docs aligned with pinned tags.","why":"Reduce drift and improve service readiness checks."}
{"key":"doctor-port-permission-skip","scope":"doctor","source":"agent","ts":"2026-01-16T21:53:02Z","type":"fix","value":"Doctor port probes now skip on PermissionError; logging falls back to console-only if log dir cannot be created (non-Windows defaults use XDG_STATE_HOME).","why":"Allow doctor/release gate to run in restricted environments without crashing."}
{"key":"thread-events-flush-order","scope":"threads","source":"agent","ts":"2026-01-17T04:35:35Z","type":"fix","value":"ThreadStore flushes thread records before inserting thread_events to satisfy FK ordering; tests adjusted to flush before thread_events.","why":"Prevent FK violations when creating new threads."}
{"key":"legacy-roi-prune","scope":"retention","source":"agent","ts":"2026-01-17T04:35:35Z","type":"fix","value":"Retention now treats legacy image_path values outside media/screen as ROI for roi_days pruning and clears matching event paths while preserving full-screen captures.","why":"Keep backward-compatible cleanup after fullscreen primary capture change."}
{"key":"sql-artifacts-parse","scope":"enrichment","source":"agent","ts":"2026-01-17T04:35:35Z","type":"fix","value":"SQL artifact extraction now detects code blocks/keywords correctly and uses default sqlglot dialect to emit statements, tables, and parse errors.","why":"Ensure deterministic SQL/code artifacts from VLM text."}
{"key":"release-gate-python","scope":"tooling","source":"agent","ts":"2026-01-17T04:35:35Z","type":"fix","value":"Release gate now invokes memory_guard with sys.executable to avoid missing python shims in WSL/venv environments.","why":"Keep release_gate portable across environments."}
{"key":"docker-digest-pins","scope":"docker","source":"agent","ts":"2026-01-17T19:16:20Z","type":"fix","value":"Docker compose and step-by-step docs now pin Postgres 16.3-bookworm and Qdrant v1.16.3 images to immutable digests (GHCR for Qdrant).","why":"Meet digest pinning requirement and reduce image drift."}
