<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Autocapture Memory Engine</title>
    <link rel="manifest" href="/static/manifest.json" />
    <link rel="stylesheet" href="/src/legacy/styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="topbar">
        <div class="brand">
          <div class="brand-mark"></div>
          <div>
            <h1>Autocapture</h1>
            <p class="brand-subtitle">Personal Memory Engine</p>
          </div>
        </div>
        <div id="statusBar" class="status-bar"></div>
        <nav class="nav-tabs">
          <button data-tab="dashboard" class="active">Dashboard</button>
          <button data-tab="chat">Ask</button>
          <button data-tab="search">Search</button>
          <button data-tab="explorer">Explorer</button>
          <button data-tab="highlights">Highlights</button>
          <button data-tab="settings">Settings</button>
          <button data-tab="plugins">Plugins</button>
          <button data-tab="maintenance">Maintenance</button>
          <button data-tab="audit">Audit</button>
          <button data-tab="logs">Logs/Perf</button>
        </nav>
      </header>
      <main>
        <section id="dashboard" class="tab active">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h2>Dashboard</h2>
                <p class="hint">Snapshot from state and storage stats.</p>
              </div>
              <button id="refreshDashboard" type="button">Refresh</button>
            </div>
            <div class="dashboard-grid">
              <div id="dashboardHealth" class="dashboard-card"></div>
              <div id="dashboardStorage" class="dashboard-card"></div>
              <div id="dashboardQueues" class="dashboard-card"></div>
              <div id="dashboardComponents" class="dashboard-card"></div>
            </div>
            <div class="dashboard-grid">
              <div id="dashboardRuntime" class="dashboard-card"></div>
              <div id="dashboardApi" class="dashboard-card"></div>
            </div>
          </div>
        </section>
        <section id="chat" class="tab">
          <div class="panel">
            <div class="controls">
              <label>Model
                <select id="modelSelect"></select>
              </label>
              <label><input type="checkbox" id="sanitizeToggle" checked /> Sanitize</label>
              <label><input type="checkbox" id="extractiveToggle" checked /> Extractive-only</label>
              <label>Time range
                <select id="timeRange">
                  <option value="24h">Last 24h</option>
                  <option value="7d">Last 7 days</option>
                  <option value="30d">Last 30 days</option>
                </select>
              </label>
              <div class="prompt-status">
                <span>Safe mode</span>
                <span id="safeModeIndicator" class="pill">--</span>
              </div>
            </div>
            <div id="answerBanner" class="banner"></div>
            <div id="thread" class="thread"></div>
            <form id="chatForm">
              <input id="chatInput" placeholder="Ask about your day..." />
              <button type="submit">Send</button>
            </form>
          </div>
        </section>
        <section id="search" class="tab">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h2>Search</h2>
                <p class="hint">Text search uses events OCR; semantic uses retrieval embeddings.</p>
              </div>
            </div>
            <form id="searchForm" class="search-form">
              <input id="searchInput" placeholder="Search events" />
              <button type="submit">Search</button>
            </form>
            <div class="search-modes">
              <label><input type="radio" name="searchMode" value="text" checked /> Text (OCR)</label>
              <label><input type="radio" name="searchMode" value="semantic" /> Semantic</label>
            </div>
            <div id="searchResults" class="results"></div>
          </div>
        </section>
        <section id="explorer" class="tab">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h2>Explorer</h2>
                <p class="hint">Browse events with thumbnails, filters, and OCR snippets.</p>
              </div>
              <div class="explorer-actions">
                <button id="applyExplorerFilters" type="button">Apply filters</button>
                <button id="clearExplorerFilters" type="button" class="secondary">Clear</button>
              </div>
            </div>
            <div class="explorer-layout">
              <aside class="explorer-filters">
                <label>Time range
                  <select id="explorerTimeRange">
                    <option value="24h">Last 24h</option>
                    <option value="7d">Last 7 days</option>
                    <option value="30d" selected>Last 30 days</option>
                    <option value="90d">Last 90 days</option>
                    <option value="all">All time</option>
                  </select>
                </label>
                <label>OCR search
                  <input id="explorerSearch" placeholder="Search OCR text" />
                </label>
                <label>Process contains
                  <input id="explorerProcess" placeholder="chrome.exe" />
                </label>
                <label>Window title contains
                  <input id="explorerWindowTitle" placeholder="Project" />
                </label>
                <div class="filter-row">
                  <label><input type="checkbox" id="explorerHasScreenshot" checked /> Has screenshot</label>
                  <label><input type="checkbox" id="explorerHasFocus" /> Has focus</label>
                </div>
                <div class="facet-group">
                  <h4>Apps</h4>
                  <div id="facetApps" class="facet-list"></div>
                </div>
                <div class="facet-group">
                  <h4>Domains</h4>
                  <div id="facetDomains" class="facet-list"></div>
                </div>
              </aside>
              <div class="explorer-results">
                <div class="explorer-meta">
                  <span id="explorerCount">0 items</span>
                  <span id="explorerStatus" class="hint"></span>
                </div>
                <div id="explorerGridViewport" class="explorer-grid-viewport">
                  <div id="explorerGrid" class="explorer-grid"></div>
                </div>
                <button id="loadMoreExplorer" type="button" class="secondary">Load more</button>
              </div>
            </div>
          </div>
        </section>
        <section id="highlights" class="tab">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h2>Nightly Highlights</h2>
                <p class="hint">Daily summaries generated from your activity history.</p>
              </div>
              <div class="highlights-controls">
                <label>Day
                  <select id="highlightsDay"></select>
                </label>
                <button id="refreshHighlights">Refresh</button>
              </div>
            </div>
            <div id="highlightsContent" class="highlights-content"></div>
          </div>
        </section>
        <section id="settings" class="tab">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h2>Settings</h2>
                <p class="hint">Schema-driven settings with preview/apply safety gates.</p>
              </div>
              <div class="tier-selector" id="tierSelector"></div>
            </div>
            <div id="settingsForm" class="settings-grid"></div>
            <div class="settings-actions">
              <button id="previewSettings" type="button">Preview changes</button>
              <button id="applySettings" type="button" class="secondary">Apply changes</button>
              <span id="settingsStatus" class="settings-status">No pending changes</span>
            </div>
            <div id="settingsPreview" class="preview-panel"></div>
          </div>
        </section>
        <section id="plugins" class="tab">
          <div class="panel">
            <h2>Plugins</h2>
            <p class="hint">Plugins are discovered but must be explicitly enabled.</p>
            <div class="plugin-banner">
              <span class="label">Safe mode</span>
              <span id="pluginSafeMode" class="pill">--</span>
            </div>
            <div id="pluginWarnings" class="plugin-warnings"></div>
            <div class="split-grid">
              <div>
                <div id="pluginList" class="plugin-list"></div>
              </div>
              <div>
                <div id="pluginDetail" class="plugin-detail">Select a plugin to view details.</div>
              </div>
            </div>
          </div>
        </section>
        <section id="maintenance" class="tab">
          <div class="panel">
            <div class="split-grid">
              <div>
                <div class="panel-header">
                  <div>
                    <h2>Doctor</h2>
                    <p class="hint">Run diagnostics across storage, OCR, embeddings, and services.</p>
                  </div>
                  <button id="runDoctor" type="button">Run doctor</button>
                </div>
                <div id="doctorResults" class="diagnostics"></div>
              </div>
              <div>
                <div class="panel-header">
                  <div>
                    <h2>Delete data</h2>
                    <p class="hint">Preview and apply destructive deletes with preview tokens.</p>
                  </div>
                </div>
                <div class="delete-form">
                  <label>Kind
                    <select id="deleteKind">
                      <option value="range">Range</option>
                      <option value="all">All</option>
                    </select>
                  </label>
                  <label>Start UTC
                    <input id="deleteStart" placeholder="2026-01-20T00:00:00Z" />
                  </label>
                  <label>End UTC
                    <input id="deleteEnd" placeholder="2026-01-21T00:00:00Z" />
                  </label>
                  <label>Process (optional)
                    <input id="deleteProcess" placeholder="chrome.exe" />
                  </label>
                  <label>Window title (optional)
                    <input id="deleteWindowTitle" placeholder="Project X" />
                  </label>
                  <label>Confirm phrase
                    <input id="deleteConfirmPhrase" placeholder="DELETE" />
                  </label>
                  <label class="confirm-check"><input type="checkbox" id="deleteConfirmCheck" /> I understand this will delete data</label>
                  <div class="delete-actions">
                    <button id="previewDelete" type="button">Preview delete</button>
                    <button id="applyDelete" type="button" class="danger">Apply delete</button>
                  </div>
                  <div id="deletePreview" class="preview-panel"></div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section id="audit" class="tab">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h2>Audit</h2>
                <p class="hint">Recent request runs, evidence counts, and citations.</p>
              </div>
              <button id="refreshAudit" type="button">Refresh</button>
            </div>
            <div class="split-grid">
              <div>
                <div id="auditList" class="audit-list"></div>
              </div>
              <div>
                <div id="auditDetail" class="audit-detail">Select a request to inspect.</div>
              </div>
            </div>
          </div>
        </section>
        <section id="logs" class="tab">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h2>Logs and Perf</h2>
                <p class="hint">Runtime latency, queues, and perf log tails.</p>
              </div>
              <div class="perf-controls">
                <label>Profile
                  <select id="perfProfileSelect">
                    <option value="auto">Auto (balanced)</option>
                    <option value="foreground">Max capture</option>
                    <option value="idle">Low impact</option>
                  </select>
                </label>
                <button id="applyPerfProfile" type="button" class="secondary">Apply</button>
              </div>
            </div>
            <div id="perfPanel" class="perf-grid"></div>
            <div class="perf-log">
              <div class="perf-log-header">
                <div>
                  <h3>Perf log</h3>
                  <p class="hint">Recent runtime snapshots from local JSONL logs.</p>
                </div>
                <div class="perf-log-controls">
                  <label>Component
                    <select id="perfLogComponent">
                      <option value="runtime">Runtime</option>
                      <option value="api">API</option>
                    </select>
                  </label>
                  <button id="refreshPerfLog" type="button" class="secondary">Refresh</button>
                </div>
              </div>
              <div id="perfLogStatus" class="hint"></div>
              <div id="perfLogEntries" class="perf-log-entries"></div>
            </div>
          </div>
        </section>
      </main>
    </div>
    <div id="eventDrawer" class="drawer hidden">
      <div class="drawer-content">
        <div class="drawer-header">
          <div>
            <h2 id="drawerTitle">Event detail</h2>
            <p id="drawerSubtitle" class="hint"></p>
          </div>
          <div class="drawer-actions">
            <button id="drawerPrev" type="button" class="secondary">Prev</button>
            <button id="drawerNext" type="button" class="secondary">Next</button>
            <button id="closeDrawer" type="button">Close</button>
          </div>
        </div>
        <div class="drawer-body">
          <div class="drawer-media">
            <div class="drawer-image-wrap">
              <img id="drawerImage" alt="Event screenshot" />
              <div id="drawerOverlay" class="drawer-overlay"></div>
            </div>
            <div class="drawer-controls">
              <label><input type="checkbox" id="toggleOcrOverlay" /> Show OCR overlay</label>
              <a id="openFullImage" href="#" target="_blank" rel="noreferrer">Open full image</a>
              <button id="drawerDelete" type="button" class="danger">Prefill delete</button>
            </div>
            <div id="drawerMeta" class="drawer-meta"></div>
          </div>
          <div class="drawer-ocr">
            <h3>OCR text</h3>
            <pre id="drawerOcrText" class="ocr-text"></pre>
          </div>
        </div>
      </div>
    </div>
    <div id="console-root" style="display:none"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
