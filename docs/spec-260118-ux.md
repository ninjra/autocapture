# SPEC-260118: UX facade + UI/CLI parity

## Integration map
- FastAPI app: `autocapture/api/app.py` includes core + UX routers.
- Core API routes: `autocapture/api/routers/core.py` (kept `/api/status` unchanged).
- UX API routes: `autocapture/api/routers/ux.py` (state/settings/doctor/delete/audit).
- Auth/unlock gate: `autocapture/api/middleware/stack.py` + `autocapture/api/middleware/security_session.py`.
- Settings persistence: `autocapture/settings_store.py` + `autocapture/config.py` overrides.
- UX facade services: `autocapture/ux/*` (state, settings, preview, doctor, delete, audit, banners).
- CLI entrypoint: `autocapture/main.py` (status/settings/delete/audit).
- Web UI: `autocapture/ui/web/index.html`, `autocapture/ui/web/app.js`, `autocapture/ui/web/styles.css`.

## UX facade modules
- `autocapture/ux/models.py`: shared Pydantic models for API + CLI.
- `autocapture/ux/state_store.py`: heartbeat read/write + writer.
- `autocapture/ux/state_service.py`: canonical `/api/state` snapshot with caching.
- `autocapture/ux/settings_schema.py`: schema-driven settings tiers + fields.
- `autocapture/ux/settings_service.py`: settings effective/preview/apply + preview token.
- `autocapture/ux/banners.py`: evidence-first banner policy + evidence summary.
- `autocapture/ux/doctor_service.py`: structured doctor reports.
- `autocapture/ux/delete_service.py`: delete preview/apply (token gated).
- `autocapture/ux/audit_service.py`: audit summaries + answer detail view.

## API routes (new)
- `GET /api/state`
- `GET /api/settings/schema`
- `GET /api/settings/effective`
- `POST /api/settings/preview`
- `POST /api/settings/apply`
- `GET /api/doctor`
- `POST /api/delete/{kind}/preview`
- `POST /api/delete/{kind}/apply`
- `GET /api/audit/requests`
- `GET /api/audit/answers/{answer_id}`

All new `/api/*` endpoints reuse the existing unlock + auth middleware.

## CLI parity (new)
- `autocapture status [--json]`
- `autocapture settings schema|get|preview|apply [--json]`
- `autocapture delete preview|apply [--json]`
- `autocapture audit list|answer [--json]`

## UI changes
- Status bar driven by `/api/state`.
- Schema-driven settings with preview/apply + tier gating.
- Maintenance tab with Doctor + delete preview/apply.
- Audit tab for recent requests and answers.
- Evidence-first banners (no-evidence/locked/degraded) in Ask.

## Tests added
- UX diff + preview token + banner policy unit tests.
- Delete preview non-mutation contract test.
- `/api/state` smoke test.
- `/api/answer` no-evidence hard stop test (LLM not invoked).
